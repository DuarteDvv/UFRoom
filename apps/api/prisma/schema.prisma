generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model address {
  id           Int            @id @default(autoincrement())
  street       String         @db.VarChar(255)
  neighborhood String?        @db.VarChar(255)
  state        String         @db.VarChar(100)
  number       Int?
  city         String         @db.VarChar(100)
  cep          String         @db.VarChar(20)
  latitude     Decimal?       @db.Decimal(9, 6)
  longitude    Decimal?       @db.Decimal(9, 6)
  complement   String?        @db.VarChar(255)
  announcement announcement[]
  owner        owner[]

  @@index([cep], map: "idx_address_cep")
  @@index([city], map: "idx_address_city")
  @@index([latitude, longitude], map: "idx_address_coordinates")
  @@index([state], map: "idx_address_state")
}

model owner {
  id           Int            @id @default(autoincrement())
  id_address   Int?
  name         String         @db.VarChar(255)
  cpf          String         @unique @db.Char(11)
  entry_at     DateTime?      @db.Date
  phone_number String?        @db.VarChar(20)
  img_url      String         @db.VarChar(255)
  announcement announcement[]
  address      address?       @relation(fields: [id_address], references: [id], onUpdate: NoAction)

  @@index([id_address], map: "idx_owner_address")
}

model announcement {
  id               Int                @id @default(autoincrement())
  id_owner         Int?
  id_address       Int?
  price            Decimal            @db.Decimal(12, 2)
  vacancies        Int?
  max_people       Int?
  description      String?
  title            String             @db.VarChar(255)
  sex              sex_enum?
  created_at       DateTime?          @default(now()) @db.Timestamp(6)
  university       String?            @db.VarChar(255)
  rules            String?            @db.VarChar(255)
  address          address?           @relation(fields: [id_address], references: [id], onUpdate: NoAction)
  owner            owner?             @relation(fields: [id_owner], references: [id], onDelete: Cascade, onUpdate: NoAction)
  announcement_img announcement_img[]

  @@index([id_owner], map: "idx_announcement_owner")
  @@index([price], map: "idx_announcement_price")
  @@index([sex], map: "idx_announcement_sex")
  @@index([university], map: "idx_announcement_university")
}

model announcement_img {
  id              Int           @id @default(autoincrement())
  id_announcement Int?
  img_url         String        @db.VarChar(255)
  announcement    announcement? @relation(fields: [id_announcement], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([id_announcement], map: "idx_announcement_img_announcement")
}

enum sex_enum {
  male
  female
  other
}
