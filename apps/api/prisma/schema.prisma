generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model address {
  id           Int            @id @default(autoincrement())
  street       String         @db.VarChar(255)
  neighborhood String?        @db.VarChar(255)
  state        String         @db.VarChar(100)
  number       Int?
  city         String         @db.VarChar(100)
  cep          String         @db.VarChar(20)
  latitude     Decimal?       @db.Decimal(9, 6)
  longitude    Decimal?       @db.Decimal(9, 6)
  complement   String?        @db.VarChar(255)
  announcement announcement[]
  owner        owner[]

  @@index([cep], map: "idx_address_cep")
  @@index([city], map: "idx_address_city")
  @@index([latitude, longitude], map: "idx_address_coordinates")
  @@index([state], map: "idx_address_state")
}

model owner {
  id           Int            @id @default(autoincrement())
  id_address   Int?
  name         String         @db.VarChar(255)
  cpf          String         @unique @db.Char(11)
  email        String         @unique @db.VarChar(255) 
  password     String         @db.VarChar(255)       
  entry_at     DateTime?      @db.Date
  updated_at   DateTime?      @default(now()) @db.Timestamptz(6)
  phone        String?        @db.VarChar(30)
  img_url      String?        @db.VarChar(255)
  announcement announcement[]
  address      address?       @relation(fields: [id_address], references: [id], onUpdate: NoAction)

  @@index([id_address], map: "idx_owner_address")
}

model announcement {
  id                      Int                       @id @default(autoincrement())
  id_owner                Int
  id_address              Int?
  price                   Decimal                   @db.Decimal(12, 2)
  occupants               Int?                      @default(0)
  max_occupants           Int?
  description             String?
  type_of                 property_type?
  status                  announcement_status?      @default(available)
  title                   String                    @db.VarChar(255)
  sex_restriction         sex_restrict?             @default(both)
  created_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  rules                   String?
  address                 address?                  @relation(fields: [id_address], references: [id], onUpdate: NoAction)
  owner                   owner                     @relation(fields: [id_owner], references: [id], onDelete: Cascade, onUpdate: NoAction)
  announcement_img        announcement_img[]
  announcement_university announcement_university[]

  @@index([id_owner], map: "idx_announcement_owner")
  @@index([price], map: "idx_announcement_price")
  @@index([sex_restriction], map: "idx_announcement_sex")
  @@index([status], map: "idx_announcement_status")
  @@index([type_of], map: "idx_announcement_type")
}

model announcement_img {
  id              Int          @id @default(autoincrement())
  id_announcement Int
  img_url         String       @db.VarChar(255)
  entry_at        DateTime?    @default(now()) @db.Timestamptz(6)
  order_idx       Int?         @default(0)
  is_cover        Boolean?     @default(false)
  announcement    announcement @relation(fields: [id_announcement], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([id_announcement, img_url])
  @@index([id_announcement], map: "idx_announcement_img_announcement")
}

model announcement_university {
  id              Int          @id @default(autoincrement())
  id_announcement Int
  id_university   Int
  distance        Float?
  announcement    announcement @relation(fields: [id_announcement], references: [id], onDelete: Cascade, onUpdate: NoAction)
  university      university   @relation(fields: [id_university], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([id_announcement, id_university])
  @@index([id_announcement], map: "idx_announcement_university_announcement")
  @@index([id_university], map: "idx_announcement_university_university")
}

model university {
  id                      Int                       @id @default(autoincrement())
  name                    String                    @db.VarChar(255)
  abbreviation            String?                   @db.VarChar(50)
  latitude                Decimal?                  @db.Decimal(9, 6)
  longitude               Decimal?                  @db.Decimal(9, 6)
  announcement_university announcement_university[]

  @@index([latitude, longitude], map: "idx_university_coordinates")
  @@index([name], map: "idx_university_name")
}

enum announcement_status {
  paused
  rented
  liberation
  full
  available
}

enum property_type {
  kitnet
  individual_room
  republic
  shared_room
}

enum sex_restrict {
  male
  female
  both
}
